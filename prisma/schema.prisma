generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model utilisateur {
  id              Int                     @id @default(autoincrement())
  name            String?
  email           String?                 @unique
  motDePasse      String?
  totalDesPoints  Int                     @default(0)
  createdAt       DateTime                @default(now())
  historique      historiqueRecompense[]
  microcours      microCours[]
  apprentissage   utilisateurMicrocours[]
  utilisationCode utilisationCode[]
}

model microCours {
  id            Int                     @id @default(autoincrement())
  titre         String
  description   String?
  createurId    Int
  createdAt     DateTime                @default(now())
  code          Code?
  createur      utilisateur             @relation(fields: [createurId], references: [id])
  apprentissage utilisateurMicrocours[]

  @@index([createurId], map: "microCours_createurId_fkey")
}

model utilisateurMicrocours {
  id            Int         @id @default(autoincrement())
  utilisateurId Int
  microcoursId  Int
  microcours    microCours  @relation(fields: [microcoursId], references: [id])
  utilisateur   utilisateur @relation(fields: [utilisateurId], references: [id])

  @@index([microcoursId], map: "utilisateurMicrocours_microcoursId_fkey")
  @@index([utilisateurId], map: "utilisateurMicrocours_utilisateurId_fkey")
}

model Code {
  id               Int               @id @default(autoincrement())
  valeur           String            @unique
  maxUtilisations  Int               @default(10)
  utilisations     Int               @default(0)
  microcoursId     Int               @unique
  microcours       microCours        @relation(fields: [microcoursId], references: [id])
  utilisationsCode utilisationCode[]
}

model utilisationCode {
  id            Int         @id @default(autoincrement())
  utilisateurId Int
  codeId        Int
  date          DateTime    @default(now())
  code          Code        @relation(fields: [codeId], references: [id])
  utilisateur   utilisateur @relation(fields: [utilisateurId], references: [id])

  @@index([codeId], map: "utilisationCode_codeId_fkey")
  @@index([utilisateurId], map: "utilisationCode_utilisateurId_fkey")
}

model Recompense {
  id                 Int                    @id @default(autoincrement())
  nom                String
  description        String?
  points_requis      Int
  quantiteDisponible Int?
  historique         historiqueRecompense[]
}

model historiqueRecompense {
  id            Int          @id @default(autoincrement())
  utilisateurId Int?
  recompenseId  Int
  date          DateTime     @default(now())
  recompense    Recompense   @relation(fields: [recompenseId], references: [id])
  utilisateur   utilisateur? @relation(fields: [utilisateurId], references: [id])

  @@index([recompenseId], map: "historiqueRecompense_recompenseId_fkey")
  @@index([utilisateurId], map: "historiqueRecompense_utilisateurId_fkey")
}
